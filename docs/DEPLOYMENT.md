# Deployment Status

**Last Updated:** November 10, 2025
**Status:** âœ… Fully Deployed and Operational

---

## ðŸš€ Live Services

### Production URLs

| Service | URL | Status |
|---------|-----|--------|
| **Frontend** | https://frontend-luwcxjaugq-an.a.run.app | âœ… Live |
| **Strategy Agent** | https://strategy-agent-luwcxjaugq-an.a.run.app | âœ… Live |
| **Creative Agent** | https://creative-agent-luwcxjaugq-an.a.run.app | âœ… Live (Auth Required) |

### Infrastructure

- **Region:** asia-northeast1 (Tokyo)
- **Platform:** Google Cloud Run
- **Pub/Sub Topic:** `creative-tasks`
- **Pub/Sub Subscription:** `creative-agent-sub` (Push endpoint with OIDC)
- **Cloud Storage Bucket:** `gs://promote-autonomy-assets/`
- **Firestore Database:** `promote-autonomy` (default database)

---

## âœ… Verified Features

### End-to-End Workflow
- âœ… User submits marketing goal via Frontend
- âœ… Strategy Agent generates plan using Gemini 2.5 Flash
- âœ… Plan saved to Firestore with `status = pending_approval`
- âœ… Frontend displays plan in real-time via Firestore listener
- âœ… User approves via HITL workflow
- âœ… Strategy Agent atomically updates Firestore + publishes to Pub/Sub
- âœ… Creative Agent triggered via Pub/Sub push subscription
- âœ… Assets generated (7 captions, 1 image, 1 video brief)
- âœ… Assets uploaded to Cloud Storage with public URLs
- âœ… Firestore updated to `status = completed`
- âœ… Frontend displays generated assets

### Asset Generation
- âœ… **Captions:** 7 engaging social media captions via Gemini 2.5 Flash
- âœ… **Images:** 1024x1024 PNG via Imagen 4.0
- âœ… **Video:** Production-ready text brief (15-20 seconds)

### Security & Performance
- âœ… Firebase Authentication (anonymous users)
- âœ… Firestore security rules (read-only client access)
- âœ… OIDC authentication for Pub/Sub push endpoint
- âœ… CORS configured for Frontend access
- âœ… Timeout protection (Gemini: 120s, Imagen: 90s, Veo: 120s)
- âœ… Proper emoji rendering (no Unicode escape sequences)
- âœ… Scrollable UI for long content
- âœ… Word wrapping for long prompts

---

## ðŸ§ª Testing Results

### Production Verification (November 10, 2025)

**Test Case:** "Attract 10,000 new users to our new AI product which specializes in creating very personal assistant for the rich. Be sure to make text and images optimized for X and instagram."

**Results:**
- âœ… Strategy generation: ~5 seconds
- âœ… Asset generation after approval: ~60 seconds
- âœ… Total workflow: ~90 seconds end-to-end
- âœ… All assets publicly accessible
- âœ… No timeout errors
- âœ… Captions displayed with proper emojis (ðŸš€, âœ¨, ðŸ‘‘)
- âœ… Image and Video descriptions fully visible (no truncation)

### Known Issues Fixed
- âœ… PR #6: Gemini timeout increased from 60s to 120s
- âœ… PR #6: Text truncation removed from Image/Video prompts
- âœ… PR #6: Added `overflowWrap: 'break-word'` to prevent UI overflow
- âœ… Local branch: Scrollable container for long content
- âœ… Local branch: Fetch and display actual captions (fixes emoji escape sequences)

---

## ðŸ“Š System Health

### Service Health Endpoints

```bash
# Strategy Agent
curl https://strategy-agent-luwcxjaugq-an.a.run.app/health
# Returns: {"status": "healthy", "service": "strategy-agent", "mock_mode": {...}}

# Creative Agent (requires auth, returns 403 as expected)
curl https://creative-agent-luwcxjaugq-an.a.run.app/health
# Returns: 403 Forbidden (correct - OIDC protected)

# Frontend
curl https://frontend-luwcxjaugq-an.a.run.app
# Returns: HTML homepage
```

### Pub/Sub Configuration

```bash
# Verify topic
gcloud pubsub topics describe creative-tasks

# Verify subscription
gcloud pubsub subscriptions describe creative-agent-sub
# Push endpoint: https://creative-agent-luwcxjaugq-an.a.run.app/api/consume
# OIDC auth: pubsub-invoker@promote-autonomy.iam.gserviceaccount.com
```

### Cloud Storage

```bash
# List generated assets
gsutil ls gs://promote-autonomy-assets/

# Example event assets
gs://promote-autonomy-assets/01K9MS28QZC6T8SK0DHXGZKPF2/
  - captions.json (7 captions with emojis)
  - image.png (generated by Imagen 4.0)
  - video_brief.txt (production brief)
```

---

## ðŸ”§ Environment Configuration

### Strategy Agent
- `PROJECT_ID`: promote-autonomy
- `LOCATION`: asia-northeast1
- `GEMINI_MODEL`: gemini-2.5-flash
- `PUBSUB_TOPIC`: creative-tasks
- `FRONTEND_URL`: https://frontend-luwcxjaugq-an.a.run.app
- `GEMINI_TIMEOUT_SEC`: 120
- `USE_MOCK_*`: all false (production mode)

### Creative Agent
- `PROJECT_ID`: promote-autonomy
- `LOCATION`: asia-northeast1
- `STORAGE_BUCKET`: promote-autonomy-assets
- `IMAGEN_MODEL`: imagen-4.0-generate-001
- `VEO_MODEL`: veo-3.0-generate-001
- `GEMINI_MODEL`: gemini-2.5-flash
- `GEMINI_TIMEOUT_SEC`: 120
- `IMAGEN_TIMEOUT_SEC`: 90
- `VEO_TIMEOUT_SEC`: 120
- `USE_MOCK_*`: all false (production mode)

### Frontend
- `NEXT_PUBLIC_FIREBASE_PROJECT_ID`: promote-autonomy
- `NEXT_PUBLIC_STRATEGY_AGENT_URL`: https://strategy-agent-luwcxjaugq-an.a.run.app
- Firebase config: properly configured

---

## ðŸš¨ Monitoring & Logs

### View Recent Logs

```bash
# Strategy Agent logs
gcloud logging read "resource.type=cloud_run_revision AND resource.labels.service_name=strategy-agent" --limit=50 --format=json

# Creative Agent logs
gcloud logging read "resource.type=cloud_run_revision AND resource.labels.service_name=creative-agent" --limit=50 --format=json

# Frontend logs
gcloud logging read "resource.type=cloud_run_revision AND resource.labels.service_name=frontend" --limit=50 --format=json
```

### Common Log Filters

```bash
# Errors only
gcloud logging read "resource.type=cloud_run_revision AND severity>=ERROR" --limit=20

# Specific event
gcloud logging read "jsonPayload.event_id='01K9MS28QZC6T8SK0DHXGZKPF2'" --limit=50
```

---

## ðŸ”„ Deployment Commands

### Redeploy Services

```bash
# Strategy Agent
cd strategy-agent
gcloud run deploy strategy-agent --source=. --region=asia-northeast1

# Creative Agent
gcloud builds submit --config=../cloudbuild-creative.yaml --region=asia-northeast1
gcloud run deploy creative-agent \
  --image="asia-northeast1-docker.pkg.dev/promote-autonomy/cloud-run-source-deploy/creative-agent" \
  --region=asia-northeast1 \
  --no-allow-unauthenticated

# Frontend
cd frontend
gcloud run deploy frontend --source=. --region=asia-northeast1 --allow-unauthenticated
```

### Update Environment Variables

```bash
# Example: Update Gemini timeout
gcloud run services update strategy-agent \
  --region=asia-northeast1 \
  --update-env-vars=GEMINI_TIMEOUT_SEC=120
```

---

## ðŸ“ˆ Performance Metrics

### Typical Response Times
- **Strategy generation**: 3-10 seconds (Gemini API call)
- **Approval processing**: <1 second (Firestore transaction + Pub/Sub publish)
- **Asset generation**: 30-90 seconds (Gemini captions + Imagen image + video brief)
- **Total workflow**: 60-120 seconds (goal â†’ completed)

### Resource Usage
- **Strategy Agent**: 512MB memory, 1 CPU
- **Creative Agent**: 1GB memory, 1 CPU (for Imagen processing)
- **Frontend**: 512MB memory, 1 CPU

---

## ðŸŽ¯ Next Steps

### Pending Improvements (see FEATURE_ROADMAP.md)
1. **Real VEO Video Generation** (1-2 hours) - Generate actual videos instead of text briefs
2. **Multi-Modal Input** (2-3 hours) - Allow product photo uploads
3. **Platform-Specific Configuration** (3-4 hours) - Generate assets for Instagram, X, LinkedIn specs
4. **Frontend Layout Fixes** (in progress on local branch)

### Deployment Pipeline
- CI/CD via GitHub Actions
- Manual deployment for now
- Future: Automated Cloud Build triggers on merge to main

---

## âœ… Hackathon Submission Checklist

- âœ… Working "Try it Out" link: https://frontend-luwcxjaugq-an.a.run.app
- âœ… Two distinct AI agents communicating via Pub/Sub
- âœ… Deployed to Cloud Run (3 services)
- âœ… Vertex AI integration (Gemini 2.5 Flash, Imagen 4.0)
- âœ… Human-in-the-Loop approval workflow
- âœ… End-to-end workflow tested and verified
- âœ… Public assets accessible
- âœ… 62/62 tests passing

**System Status:** Production-Ready âœ…
